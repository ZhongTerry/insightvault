<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightVault | 应用</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Playfair+Display:wght@600&display=swap');
        :root {
            --bg-1: #f8f2e7;
            --bg-2: #e8f4f1;
            --ink: #1b1f23;
            --muted: #667085;
            --primary: #0e7c7b;
            --accent: #f76c4f;
            --card: rgba(255, 255, 255, 0.9);
            --line: rgba(20, 20, 20, 0.08);
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Space Grotesk', sans-serif;
            color: var(--ink);
            background:
                radial-gradient(circle at 10% 20%, rgba(247, 108, 79, 0.15), transparent 40%),
                radial-gradient(circle at 80% 10%, rgba(14, 124, 123, 0.18), transparent 35%),
                linear-gradient(160deg, var(--bg-1), var(--bg-2));
            min-height: 100vh;
        }
        .wrap { max-width: 1000px; margin: 0 auto; padding: 42px 20px 80px; }
        .nav {
            display: flex; align-items: center; justify-content: space-between; gap: 16px;
            margin-bottom: 28px;
        }
        .brand {
            font-family: 'Playfair Display', serif;
            font-size: 26px; letter-spacing: 0.5px;
        }
        .nav-links a {
            color: var(--ink); text-decoration: none; margin-left: 16px; font-weight: 600;
        }
        .user-pill {
            padding: 6px 10px; border-radius: 999px; background: #fff; border: 1px solid var(--line);
            font-size: 12px; color: var(--muted);
        }
        .row { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 12px; }
        .row:last-of-type { margin-bottom: 0; }
        .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 12px 30px rgba(14, 124, 123, 0.08);
            animation: rise 0.6s ease-out;
            margin-bottom: 18px;
        }
        input, select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--line); border-radius: 10px;
            font-size: 14px; background: #fff; outline: none; font-family: inherit;
        }
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        .template-field {
            margin-bottom: 8px;
        }
        .template-field label {
            display: block;
            font-size: 12px;
            color: var(--muted);
            margin-bottom: 4px;
        }
        .template-field input,
        .template-field textarea {
            margin-bottom: 0;
        }
        button {
            padding: 10px 16px; border-radius: 10px; border: 1px solid transparent;
            font-weight: 600; cursor: pointer;
        }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }
        .btn-accent { background: var(--accent); color: #fff; }
        .btn-ghost { background: transparent; border-color: var(--ink); color: var(--ink); }
        .btn-small { font-size: 12px; padding: 6px 10px; }
        .muted { color: var(--muted); font-size: 12px; }
        .item { border-bottom: 1px solid var(--line); padding: 14px 4px; }
        .item:last-child { border-bottom: none; }
        .item-meta { font-size: 12px; color: var(--muted); display: flex; justify-content: space-between; gap: 10px; }
        .tag { font-size: 11px; background: #f0f0f0; padding: 2px 6px; border-radius: 6px; margin-left: 6px; }
        .score { font-size: 11px; color: #0e7c7b; background: #e9f6f5; padding: 2px 6px; border-radius: 6px; }
        .status-pending { font-size: 11px; color: var(--muted); background: #eee; padding: 2px 6px; border-radius: 6px; }
        .status-failed { font-size: 11px; color: #fff; background: var(--accent); padding: 2px 6px; border-radius: 6px; }
        .pagination { display: flex; gap: 12px; align-items: center; justify-content: center; margin-top: 16px; }
        #loader { display: none; text-align: center; color: var(--primary); font-weight: 600; margin: 12px 0; }
        @keyframes rise { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        
        .toast {
            position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
            background: var(--ink); color: #fff; padding: 10px 20px; border-radius: 12px;
            font-size: 14px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 2000; animation: toastIn 0.3s ease-out;
        }
        @keyframes toastIn { from { bottom: 0; opacity: 0; } to { bottom: 24px; opacity: 1; } }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
            z-index: 1000;
        }
        .modal-card {
            background: var(--bg-1); width: 90%; max-width: 600px; padding: 24px;
            border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            max-height: 85vh; overflow-y: auto;
        }
        .tag-list-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 0; border-bottom: 1px solid var(--line);
        }
        .tag-list-item:last-child { border-bottom: none; }

        @media (max-width: 700px) {
            .nav { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <div class="nav">
            <div>
                <div class="brand">InsightVault</div>
                <div class="muted">你的个人与团队情报空间</div>
            </div>
            <div>
                <span class="user-pill" id="userPill">未登录</span>
                <span class="nav-links">
                    <a href="/">首页</a>
                    <a href="/reading">稍后阅读</a>
                    <a href="/groups">团队</a>
                    <a href="#" onclick="openManageTagsModal()">标签管理</a>
                    <a href="/settings">设置</a>
                    <a href="/login" onclick="logout()">退出</a>
                </span>
            </div>
        </div>

        <div class="card">
            <div class="row">
                <select id="templateSelect" onchange="onTemplateChange()" style="width: auto;">
                    <option value="none">无模板（自由输入）</option>
                    <option value="item_entry">条目填充模板</option>
                    <option value="book_note">读书笔记模板</option>
                    <option value="meeting_record">会议记录模板</option>
                    <option value="problem_record">错题记录模板</option>
                </select>
            </div>
            <div id="freeInputArea" class="row">
                <input id="addTitle" placeholder="标题（可选）" style="margin-bottom: 8px;">
                <textarea id="addInput" placeholder="记录新的灵感、情报或链接（支持Markdown）..." onkeydown="handleKeydown(event, addData)"></textarea>
            </div>
            <div id="templateInputArea" style="display: none;">
                <!-- 模板输入框将动态生成 -->
            </div>
            <div class="row">
                <input id="tagsInput" placeholder="标签 (逗号分隔)">
                <select id="visibilitySelect" onchange="onVisibilityChange()">
                    <option value="private">仅自己</option>
                    <option value="group">团队共享</option>
                </select>
                <select id="groupSelect" disabled>
                    <option value="">选择团队</option>
                </select>
            </div>
            <button id="addBtn" class="btn-primary" onclick="addData()">存入情报</button>
        </div>

        <div class="card">
            <textarea id="searchInput" placeholder="搜索已存内容..." onkeydown="handleKeydown(event, () => doSearch('ai'))" style="margin-bottom: 12px;"></textarea>
            <div class="row">
                <button class="btn-primary" onclick="doSearch('ai')">AI 搜索</button>
                <button class="btn-accent" onclick="doSearch('key')">关键词</button>
                <button class="btn-ghost" onclick="doSearch('tag')">标签</button>
                <button class="btn-ghost" onclick="doSearch('all')">全部</button>
                <button id="revectorizeBtn" class="btn-ghost" onclick="revectorizeAll()">重构向量</button>
            </div>
        </div>

        <div id="loader">处理中...</div>
        <div class="card" id="results"></div>

        <div class="pagination">
            <button id="prevBtn" class="btn-ghost" onclick="changePage(-1)">上一页</button>
            <span id="pageInfo" class="muted">第 1 页</span>
            <button id="nextBtn" class="btn-ghost" onclick="changePage(1)">下一页</button>
        </div>
    </div>

    <!-- Manage Tags Modal -->
    <div id="manageTagsModal" class="modal-overlay" style="display: none;">
        <div class="modal-card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h3>标签管理</h3>
                <button class="btn-ghost btn-small" onclick="closeManageTagsModal()">关闭</button>
            </div>
            <div id="tagsListContainer" style="margin-top: 16px;">
                <div class="muted">正在加载标签...</div>
            </div>
        </div>
    </div>

    <!-- Rename Tag Modal -->
    <div id="renameTagModal" class="modal-overlay" style="display: none; z-index: 1001;">
        <div class="modal-card" style="max-width: 400px;">
            <h3>重命名标签</h3>
            <input id="renameTagNameInput" placeholder="新的标签名称">
            <div class="row" style="justify-content: flex-end; margin-top: 12px;">
                <button class="btn-ghost" onclick="closeRenameTagModal()">取消</button>
                <button class="btn-primary" onclick="saveTagName()">保存</button>
            </div>
        </div>
    </div>

    <script>
        let currentPage = 1;
        let currentType = 'all';
        let currentQuery = '';
        let authToken = localStorage.getItem('authToken') || '';
        let currentUser = null;
        let currentGroups = [];
        let currentTemplate = 'none';

        // 模板配置
        const templates = {
            none: {
                name: '无模板（自由输入）',
                fields: []
            },
            item_entry: {
                name: '条目填充模板',
                fields: [
                    { key: 'name', label: '名称', type: 'input', placeholder: '输入条目名称' },
                    { key: 'category', label: '分类', type: 'input', placeholder: '输入分类' },
                    { key: 'detail', label: '详细说明', type: 'textarea', placeholder: '输入详细信息' }
                ],
                format: (data) => ({
                    title: `条目：${data.name}`,
                    content: `${data.name} 是一个关于 ${data.category} 的条目，具体细节如下：\n\n${data.detail}`
                })
            },
            book_note: {
                name: '读书笔记模板',
                fields: [
                    { key: 'book_title', label: '书名', type: 'input', placeholder: '输入书名' },
                    { key: 'author', label: '作者', type: 'input', placeholder: '输入作者' },
                    { key: 'chapter', label: '章节', type: 'input', placeholder: '第几章或页码' },
                    { key: 'quote', label: '摘录', type: 'textarea', placeholder: '书中的原文或要点' },
                    { key: 'reflection', label: '感悟', type: 'textarea', placeholder: '你的思考和心得' }
                ],
                format: (data) => ({
                    title: `读《${data.book_title}》有感`,
                    content: `## 读书笔记\n\n**书名**：${data.book_title}\n**作者**：${data.author}\n**章节**：${data.chapter}\n\n### 摘录\n> ${data.quote}\n\n### 我的感悟\n${data.reflection}`
                })
            },
            meeting_record: {
                name: '会议记录模板',
                fields: [
                    { key: 'meeting_title', label: '会议主题', type: 'input', placeholder: '输入会议主题' },
                    { key: 'date', label: '日期', type: 'input', placeholder: '会议日期' },
                    { key: 'participants', label: '参会人员', type: 'input', placeholder: '参会人员名单' },
                    { key: 'summary', label: '会议要点', type: 'textarea', placeholder: '讨论的主要内容' },
                    { key: 'action_items', label: '行动项', type: 'textarea', placeholder: '待办事项和责任人' }
                ],
                format: (data) => ({
                    title: `会议记录：${data.meeting_title}`,
                    content: `## 会议信息\n- **日期**：${data.date}\n- **主要人员**：${data.participants}\n\n## 会议要点\n${data.summary}\n\n## 行动项\n${data.action_items}`
                })
            },
            problem_record: {
                name: '错题记录模板',
                fields: [
                    { key: 'subject', label: '科目/领域', type: 'input', placeholder: '如：数学、前端、后端等' },
                    { key: 'question', label: '题目描述', type: 'textarea', placeholder: '详细记录错题内容' },
                    { key: 'wrong_reason', label: '错误原因', type: 'input', placeholder: '如：概念不清、粗心、逻辑错误等' },
                    { key: 'solution', label: '解析与总结', type: 'textarea', placeholder: '正确解法、相关知识点及避坑指南' }
                ],
                format: (data) => ({
                    title: `【错题本】${data.subject} - ${data.question.substring(0, 15)}...`,
                    content: `### 题目内容\n${data.question}\n\n### 错误原因\n${data.wrong_reason}\n\n### 正确解析与总结\n${data.solution}`
                })
            }
        };

        function onTemplateChange() {
            const templateKey = document.getElementById('templateSelect').value;
            currentTemplate = templateKey;
            const template = templates[templateKey];
            
            const freeArea = document.getElementById('freeInputArea');
            const templateArea = document.getElementById('templateInputArea');
            
            if (templateKey === 'none') {
                freeArea.style.display = 'flex';
                templateArea.style.display = 'none';
            } else {
                freeArea.style.display = 'none';
                templateArea.style.display = 'block';
                
                // 动态生成模板输入框
                templateArea.innerHTML = '';
                template.fields.forEach(field => {
                    const div = document.createElement('div');
                    div.className = 'template-field';
                    const label = document.createElement('label');
                    label.textContent = field.label;
                    div.appendChild(label);
                    
                    if (field.type === 'textarea') {
                        const textarea = document.createElement('textarea');
                        textarea.id = `tmpl_${field.key}`;
                        textarea.placeholder = field.placeholder;
                        textarea.style.minHeight = '60px';
                        div.appendChild(textarea);
                    } else {
                        const input = document.createElement('input');
                        input.id = `tmpl_${field.key}`;
                        input.placeholder = field.placeholder;
                        div.appendChild(input);
                    }
                    
                    templateArea.appendChild(div);
                });
            }
        }

        function getTemplateContent() {
            if (currentTemplate === 'none') {
                return {
                    title: document.getElementById('addTitle').value.trim() || '未命名 intelligence',
                    content: document.getElementById('addInput').value.trim()
                };
            }
            
            const template = templates[currentTemplate];
            const data = {};
            
            // 收集模板字段数据
            for (const field of template.fields) {
                const elem = document.getElementById(`tmpl_${field.key}`);
                const value = elem ? elem.value.trim() : '';
                if (!value) {
                    alert(`请填写「${field.label}」`);
                    return null;
                }
                data[field.key] = value;
            }
            
            // 使用模板格式化函数生成标题和内容
            return template.format(data);
        }

        function clearTemplateInputs() {
            document.getElementById('addTitle').value = '';
            if (currentTemplate === 'none') {
                document.getElementById('addInput').value = '';
            } else {
                const template = templates[currentTemplate];
                template.fields.forEach(field => {
                    const elem = document.getElementById(`tmpl_${field.key}`);
                    if (elem) elem.value = '';
                });
            }
        }

        function handleKeydown(e, callback) {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                callback();
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('authUser');
        }

        function showToast(msg) {
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerText = msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 2500);
        }

        async function apiCall(endpoint, method = 'GET', body = null) {
            try {
                const options = { method };
                if (body) {
                    options.headers = { 'Content-Type': 'application/json' };
                    options.body = JSON.stringify(body);
                }
                if (authToken) {
                    options.headers = options.headers || {};
                    options.headers['Authorization'] = `Bearer ${authToken}`;
                }
                const res = await fetch(endpoint, options);
                if (res.status === 401) {
                    logout();
                    window.location.href = '/login';
                    return null;
                }
                if (!res.ok) {
                    const errorText = await res.text();
                    console.error(`API Error [${res.status}]:`, errorText);
                    alert(`请求失败 (${res.status}): ${errorText.substring(0, 100)}`);
                    return null;
                }
                return await res.json();
            } catch (error) {
                console.error('Network error:', error);
                alert('无法连接到服务器，请确保后端服务正在运行。\n\n提示: 运行 py main.py web 启动服务器');
                return null;
            }
        }

        async function loadMe() {
            const res = await apiCall('/api/auth/me');
            if (!res || !res.user) return;
            currentUser = res.user;
            document.getElementById('userPill').innerText = currentUser.name || currentUser.email;
            const isAdmin = currentUser.role === 'admin';
            document.getElementById('revectorizeBtn').style.display = isAdmin ? 'inline-block' : 'none';
        }

        async function loadGroups() {
            const res = await apiCall('/api/groups');
            currentGroups = (res && res.groups) ? res.groups : [];
            const select = document.getElementById('groupSelect');
            select.innerHTML = '<option value="">选择团队</option>';
            currentGroups.forEach(g => {
                const opt = document.createElement('option');
                opt.value = g.group_id;
                opt.textContent = `${g.name} (${g.role})`;
                select.appendChild(opt);
            });
        }

        function onVisibilityChange() {
            const visibility = document.getElementById('visibilitySelect').value;
            const groupSelect = document.getElementById('groupSelect');
            groupSelect.disabled = visibility !== 'group';
        }

        async function render(type, q, page) {
            currentType = type;
            currentQuery = q;
            currentPage = page;

            document.getElementById('loader').style.display = 'block';
            const res = await apiCall(`/api/v1/items?type=${type}&q=${encodeURIComponent(q)}&page=${page}&per_page=10`);
            const container = document.getElementById('results');
            document.getElementById('loader').style.display = 'none';

            if (!res || !res.data) {
                container.innerHTML = '<div class="muted">加载失败</div>';
                return;
            }
            
            const data = res.data;
            container.innerHTML = data.length ? '' : '<div class="muted">无内容</div>';

            data.forEach(item => {
                const createdAt = new Date(item.created_at).toLocaleString('zh-CN');
                const scoreStr = item.score ? `<span class="score">匹配度 ${(item.score * 100).toFixed(1)}%</span>` : '';
                
                let statusStr = '';
                if (item.vectorization_status === 'pending') {
                    statusStr = `<span class="status-pending">⌛ 向量化中...</span>`;
                } else if (item.vectorization_status === 'failed') {
                    statusStr = `<span class="status-failed">⚠ 向量化失败</span>`;
                }

                const itemEl = document.createElement('div');
                itemEl.className = 'item';
                itemEl.id = `item-${item.id}`;
                itemEl.style.cursor = 'pointer';
                itemEl.onclick = () => viewDetail(item.id);
                
                // 创建结构
                itemEl.innerHTML = `
                    <div class="item-title" style="font-weight: 600; font-size: 16px; margin-bottom: 8px;"></div>
                    <div class="item-preview" style="color: var(--muted); margin-bottom: 8px;"></div>
                    <div class="item-meta" style="font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
                        <span>${createdAt}</span>
                        ${scoreStr}
                        ${statusStr}
                        <span class="vis-pill"></span>
                        <span class="tags-container"></span>
                    </div>
                `;
                
                // 填充纯文本内容（防XSS）
                itemEl.querySelector('.item-title').textContent = item.title || '无标题';
                itemEl.querySelector('.item-preview').textContent = (item.content_preview || item.content || '') + '...';
                
                // 填充可见性
                const visPill = itemEl.querySelector('.vis-pill');
                visPill.className = 'tag';
                visPill.textContent = item.visibility === 'group' ? `团队: ${item.group_name || '未命名'}` : '私有';
                
                // 填充标签
                const tagsContainer = itemEl.querySelector('.tags-container');
                const tagsArr = Array.isArray(item.tags) ? item.tags : [];
                tagsArr.forEach(t => {
                    const ts = document.createElement('span');
                    ts.className = 'tag';
                    ts.textContent = '#' + t;
                    tagsContainer.appendChild(ts);
                });
                
                container.appendChild(itemEl);
            });

            document.getElementById('pageInfo').innerText = `第 ${page} 页`;
            document.getElementById('prevBtn').disabled = (page === 1);
            document.getElementById('nextBtn').disabled = !res.pagination.has_more;
        }

        function viewDetail(id) {
            window.location.href = `/detail?id=${id}`;
        }

        function doSearch(type) {
            if (type === 'all') document.getElementById('searchInput').value = '';
            render(type, document.getElementById('searchInput').value, 1);
        }

        async function addData() {
            const templateRes = getTemplateContent();
            if (!templateRes) return;
            const { title, content } = templateRes;
            if (!content) return alert('内容不能为空');
            
            const visibility = document.getElementById('visibilitySelect').value;
            const groupId = document.getElementById('groupSelect').value || null;
            const tagsRaw = document.getElementById('tagsInput').value;
            
            if (visibility === 'group' && !groupId) return alert('请选择团队');
            
            const btn = document.getElementById('addBtn');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = '正在存入...';

            try {
                const res = await apiCall('/api/v1/items', 'POST', {
                    title,
                    content,
                    visibility,
                    group_id: visibility === 'group' ? parseInt(groupId, 10) : null,
                    tags: tagsRaw
                });
                
                if (res && res.status === 'success') {
                    showToast('已存入情报 ✨');
                    document.getElementById('addTitle').value = '';
                    clearTemplateInputs();
                    document.getElementById('tagsInput').value = '';
                    render('all', '', 1);
                }
            } finally {
                btn.disabled = false;
                btn.innerText = originalText;
            }
        }

        async function openManageTagsModal() {
            document.getElementById('manageTagsModal').style.display = 'flex';
            await loadTagsList();
        }

        function closeManageTagsModal() {
            document.getElementById('manageTagsModal').style.display = 'none';
        }

        async function loadTagsList() {
            const container = document.getElementById('tagsListContainer');
            container.innerHTML = '<div class="muted">正在加载...</div>';
            const res = await apiCall('/api/tags');
            if (!res || !res.tags) {
                container.innerHTML = '<div class="muted">加载失败</div>';
                return;
            }
            if (res.tags.length === 0) {
                container.innerHTML = '<div class="muted">你还没有创建任何标签</div>';
                return;
            }
            container.innerHTML = '';
            res.tags.forEach(t => {
                const div = document.createElement('div');
                div.className = 'tag-list-item';
                const labelStr = t.visibility === 'group' ? `<small class="muted">(团队)</small>` : '';
                div.innerHTML = `
                    <span><strong>#${t.name}</strong> ${labelStr}</span>
                    <span>
                        <button class="btn-ghost btn-small" onclick="renameTag(${t.id}, '${t.name}')">重命名</button>
                        <button class="btn-ghost btn-small" style="color:red; border-color:red;" onclick="deleteTag(${t.id})">删除</button>
                    </span>
                `;
                container.appendChild(div);
            });
        }

        let renamingTagId = null;

        async function renameTag(id, name) {
            renamingTagId = id;
            document.getElementById('renameTagNameInput').value = name;
            document.getElementById('renameTagModal').style.display = 'flex';
        }

        function closeRenameTagModal() {
            document.getElementById('renameTagModal').style.display = 'none';
        }

        async function saveTagName() {
            const newName = document.getElementById('renameTagNameInput').value;
            if (newName) {
                const res = await apiCall(`/api/tags/${renamingTagId}`, 'PUT', { name: newName });
                if (res && res.status === 'success') {
                    closeRenameTagModal();
                    await loadTagsList();
                    render(currentType, currentQuery, currentPage);
                }
            }
        }

        async function deleteTag(id) {
            if (!confirm('确定要彻底删除这个标签吗？所有关联的情报将不再拥有此标签。')) return;
            const res = await apiCall(`/api/tags/${id}`, 'DELETE');
            if (res && res.status === 'success') {
                await loadTagsList();
                render(currentType, currentQuery, currentPage);
            }
        }

        function changePage(delta) { render(currentType, currentQuery, currentPage + delta); }

        async function revectorizeAll() {
            if (!confirm('这将消耗大量 API 额度，确定吗？')) return;
            const res = await apiCall('/api/revectorize_all', 'POST');
            if (res && res.status === 'success') {
                alert('任务已启动，请稍后查看效果。');
            } else {
                alert('操作失败，请检查后端日志。');
            }
        }

        window.onload = async () => {
            if (!authToken) {
                window.location.href = '/login';
                return;
            }
            onVisibilityChange();
            await loadMe();
            await loadGroups();
            const params = new URLSearchParams(window.location.search);
            render(params.get('type') || 'all', params.get('q') || '', parseInt(params.get('page')) || 1);
        };
    </script>
</body>
</html>
